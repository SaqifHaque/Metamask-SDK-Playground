<script src="/node_modules/@metamask/sdk/dist/browser/iife/metamask-sdk.js"></script>
<script src="/node_modules/ethers/dist/ethers.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.2/ethers.umd.min.js" integrity="sha512-f+t6//rz3Iy3hp1CiwtsigYtyWuGk7bf6xl2RTOPvmyMIfTQJ4iy6Lg1dah1bsLQ9SLideJGicgmOkBsBXP1aA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
  const sdk = new MetaMaskSDK.MetaMaskSDK({
    dappMetadata: {
      name: "Pure JS example",
      url: window.location.host,
    },
    logging: {
      sdk: false,
    }
  });
</script>
<script>
  //let provider;
  let walletaddress;

  // NFT Contract ABI
  const contractABI = [
    "function ownerOf(uint256 tokenId) view returns (address)"
  ];

  const contractAddress = "0x86159832B39ca887E47E4691a22Ab2612614F1Cd";

  const tokenId = "3";

  const provider = new ethers.BrowserProvider(window.ethereum);

  function connectWalletAndGetOwner(tokenId) {
    if (typeof window.ethereum !== 'undefined') {
        const nftContractAddress = document.getElementById('nft').value;
        provider.send("eth_requestAccounts", [])
        .then(() => provider.getSigner())
        .then((signer) => {
            // Create a contract instance
            const nftContract = new ethers.Contract(nftContractAddress, contractABI, signer);
            
            // Call the ownerOf function
            return nftContract.ownerOf(tokenId)
        })
        .then((ownerAddress) => {
            console.log(`Owner of token ${tokenId}: ${ownerAddress}`);
        })
        .catch((error) => {
            console.error("Error fetching owner:", error);
        });
    } else {
        console.error('Ethereum provider is not available. Make sure MetaMask is installed.');
    }
  }

  function connect() {
    sdk.connect()
      .then((res) => {
        provider = sdk.getProvider();
        console.log(provider, 'provider')
        console.log(res.data, res,'data');
        //document.getElementById('provider-info').textContent = `Provider: ${provider}`;
        provider.request({ method: 'eth_requestAccounts' })
          .then((accounts) => {
            walletAddress = accounts[0];
            console.log('Wallet Address:', walletAddress);

            // Update the paragraph with the wallet address
            document.getElementById('provider-info').textContent = `Wallet Address: ${walletAddress}`;

            //addEthereumChain();
          })
          .catch((err) => console.log('Failed to get accounts:', err));
      })
      .catch((e) => console.log('request accounts ERR', e));
  }

  function addEthereumChain() {
    provider
      .request({
        method: 'wallet_addEthereumChain',
        params: [
        {
          chainId: '0xAA6D7F', // Chain ID for Sepolia
          chainName: 'Sepolia test network',
          nativeCurrency: { symbol: 'ETH', decimals: 18 },
          rpcUrls: ['https://sepolia.infura.io/v3/'], // Public RPC URL
          blockExplorerUrls: ['https://sepolia.etherscan.io'],
        },
        ],
      })
      .then((res) => console.log('add', res))
      .catch((e) => console.log('ADD ERR', e));
  }

  function ethToWei(eth) {
    // Convert ETH to wei
    const weiMultiplier = BigInt(10 ** 18);
    const ethBigInt = BigInt(Math.floor(parseFloat(eth) * 1e18));
    return ethBigInt;
    }

  function sendTransaction() {
    if (!provider) {
      console.log('Provider not initialized. Connect first.');
      return;
    }

    try {
      const accounts = provider.request({ method: 'eth_requestAccounts' });
      const sender = accounts[0]; // The account from which to send the transaction

      const recipientAddress = document.getElementById('recipient-address').value;
      const amountInEth = document.getElementById('amount').value;

      console.log(recipientAddress, 'recip');

      const transactionParameters = {
        to: recipientAddress, 
        from: sender,
        value: ethToWei(amountInEth), // 0.01 ETH in wei (1 ETH = 10^18 wei)
        gas: '0x5208', // 21000 Gwei (basic transaction cost)
      };

      // Sending the transaction
      const txHash = provider.request({
        method: 'eth_sendTransaction',
        params: [transactionParameters],
      });

      console.log('Transaction sent! Hash:', txHash);
    } catch (e) {
      console.log('Failed to send transaction:', e);
    }
  }

  async function validateNFTOwnership(tokenId) {
      // Check if MetaMask is installed
      if (typeof window.ethereum !== 'undefined') {

        // Create a new Web3 provider
        const web3Provider = new ethers.BrowserProvider(window.ethereum);

        // Get the signer (the current user)
        const signer = web3Provider.getSigner();

        // Get the user's address
        const userAddress = walletaddress;

        const contractAddress = document.getElementById('nft').value;

        // Create a new instance of the NFT contract
        const contract = new ethers.Contract(contractAddress, contractABI, signer);

        conso

        try {
          // Call the ownerOf function to get the owner of the NFT
          const ownerAddress = await contract.ownerOf(tokenId);
          console.log(`Owner of token ID ${tokenId}: ${ownerAddress}`);

          // Compare the retrieved address with the user's address
          if (ownerAddress.toLowerCase() === userAddress.toLowerCase()) {
            console.log("You are the owner of this NFT.");
          } else {
            console.log("You are NOT the owner of this NFT.");
          }
        } catch (error) {
          console.error("Error fetching owner:", error);
        }
      } else {
        console.log("MetaMask is not installed.");
      }
    }


</script>
<button onclick="connect()">Connect</button>
<p id="provider-info"></p>

<h2>Send Eth</h2>

<label for="recipient-address">Recipient Address:</label>
<input type="text" id="recipient-address" placeholder="Enter recipient address" />
<br>
<br>
<label for="amount">Amount:</label>
<input type="text" id="amount" placeholder="Enter amount" />
<button onclick="sendTransaction()">Send</button>


<h2>Validate NFT</h2>
<label for="amount">Nft Address:</label>
<input type="text" id="nft" placeholder="Enter address" />
<button onclick="connectWalletAndGetOwner()">Validate</button>